<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Token de Cartão (Teste)</title>
    <script src="https://sdk.mercadopago.com/js/v2"></script>
    <style>
      body {
        font-family:
          system-ui,
          -apple-system,
          Segoe UI,
          Roboto,
          Arial,
          sans-serif;
        max-width: 520px;
        margin: 24px auto;
        padding: 0 16px;
      }
      .hint {
        font-size: 12px;
        margin: 8px 0 16px;
      }
      .row {
        margin-bottom: 12px;
      }
      #cardNumber,
      #expirationDate,
      #securityCode {
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 12px;
      }
      button {
        width: 100%;
        padding: 12px 16px;
        border: 0;
        border-radius: 8px;
        background: #009ee3;
        color: #fff;
        font-weight: 600;
        cursor: pointer;
      }
      pre {
        background: #0b1020;
        color: #cde3ff;
        padding: 12px;
        border-radius: 8px;
        overflow: auto;
      }
      label {
        display: block;
        font-size: 13px;
        margin-bottom: 6px;
        color: #333;
      }
      input {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid #ddd;
        border-radius: 8px;
      }
    </style>
  </head>
  <body>
    <h1>Gerar token de cartão (ambiente de teste)</h1>

    <div class="hint">
      Use chave pública de teste e dados de teste. Exemplo: número do cartão
      <b>5031433215406351</b>, vencimento <b>11/30</b>, CVV <b>123</b>, nome
      <b>APRO</b>, CPF <b>12345678909</b>.
    </div>

    <form id="pay">
      <div class="row">
        <label for="cardholderName">Nome impresso no cartão</label>
        <input id="cardholderName" value="APRO" required />
      </div>

      <div class="row">
        <label for="docType">Tipo de documento</label>
        <input id="docType" value="CPF" required />
      </div>

      <div class="row">
        <label for="docNumber">Documento</label>
        <input id="docNumber" value="12345678909" required />
      </div>

      <div class="row">
        <label>Número do cartão</label>
        <div id="cardNumber"></div>
      </div>

      <div class="row">
        <label>Validade (MM/AA)</label>
        <div id="expirationDate"></div>
      </div>

      <div class="row">
        <label>Código de segurança</label>
        <div id="securityCode"></div>
      </div>

      <button type="submit">Gerar token de teste</button>
    </form>

    <h3>Resposta</h3>
    <pre id="out"></pre>

    <script>
      const mp = new MercadoPago("TEST-fba2e39a-bcac-4925-bca8-9c7bce374394", {
        locale: "pt-BR",
      });
      const cardNumberElement = mp.fields
        .create("cardNumber")
        .mount("cardNumber");
      const expirationDateElement = mp.fields
        .create("expirationDate")
        .mount("expirationDate");
      const securityCodeElement = mp.fields
        .create("securityCode")
        .mount("securityCode");
      const form = document.getElementById("pay");
      const out = document.getElementById("out");

      let currentBin = null;
      cardNumberElement.on("binChange", async ({ bin }) => {
        currentBin = bin;
      });

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const amount = "40";
        const bin = currentBin || "503143";
        const installments = await mp.getInstallments({
          amount,
          bin,
          paymentTypeId: "credit_card",
        });
        console.log(installments);

        const cardholderName = document.getElementById("cardholderName").value;
        const identificationType = document.getElementById("docType").value;
        const identificationNumber = document.getElementById("docNumber").value;

        const result = await mp.fields.createCardToken({
          cardholderName,
          identificationType,
          identificationNumber,
          cardNumberElement,
          expirationDateElement,
          securityCodeElement,
        });

        out.textContent = JSON.stringify(result, null, 2);
      });
    </script>
  </body>
</html>
